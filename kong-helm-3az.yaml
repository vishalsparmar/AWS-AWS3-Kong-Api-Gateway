# values.yaml for Kong on EKS with NLB and AZ-spread

# Disable the ingress controller if AWS LB Controller handles ingress
ingressController:
  enabled: false

# Kong proxy service exposed via AWS NLB
proxy:
  enabled: true
  type: LoadBalancer
  loadBalancerClass: service.k8s.aws/nlb
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: "ip"
    service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"
    # Replace with your subnet IDs (one per AZ)
    service.beta.kubernetes.io/aws-load-balancer-subnets: "subnet-aaa,subnet-bbb,subnet-ccc"
  externalTrafficPolicy: Local
  http:
    enabled: true
    servicePort: 80
  tls:
    enabled: true
    servicePort: 443

# Kong Deployment configuration
replicaCount: 3   # should match number of AZs you want pods in

affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
                - kong
        topologyKey: "kubernetes.io/hostname"

topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: topology.kubernetes.io/zone
    whenUnsatisfiable: DoNotSchedule
    labelSelector:
      matchLabels:
        app.kubernetes.io/name: kong

image:
  repository: kong/kong-gateway
  tag: "3.7"   # replace with version you need

# Database options (if you are running DB-less mode, keep disabled)
env:
  database: "off"
